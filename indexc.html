<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <style>

        #states path {
            fill: #ccc;
            stroke: #fff;
        }

        path.arc {
            pointer-events: none;
            fill: none;
            stroke: #000;
            display: none;
        }

        path.cell {
            fill: none;
            pointer-events: all;
        }

        circle {
            fill: steelblue;
            fill-opacity: .8;
            stroke: #fff;
        }

        #cells.voronoi path.cell {
            stroke: brown;
        }

        #cells g:hover path.arc {
            display: inherit;
        }
    </style>
</head>
<body>

<div id="mapi" style="border:1px dotted blue; width: 200px; height: 475px; position: absolute; right: 10px;"></div>
<!--div id="container1" style="border:1px dotted blue; width: 700px; height: 475px; position: relative;"></div-->
<script src="/components/d3/d3.min.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>


<script>

    var margin = {top: 20, right: 20, bottom: 30, left: 40},
        width = (window.innerWidth - 250) - margin.left - margin.right,
        height = (window.innerHeight -50)  - margin.top - margin.bottom;

    var defaultZoom = 1;
    var defaultTranslateX = 0;
    var defaultTranslateY = 0;

    var projection = d3.geoNaturalEarth();
        //.scale(200);

    var path = d3.geo.path()
        .projection(projection);

    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


    var states = svg.append("svg:g")
        .attr("id", "states") ;

    var circles = svg.append("svg:g")
        .attr("id", "circles");

    var cells = svg.append("svg:g")
        .attr("id", "cells");



    var g = svg.append("g");


    /*d3.select("input[type=checkbox]").on("change", function() {
        cells.classed("voronoi", this.checked);
    });*/








        d3.csv("/data/ForestData.csv", function (countries){
            countries.forEach(function (country) {




                console.log("COUNTRY" + country)

                var cName = country.Country,
                    startArea= country.y1990,
                    endArea = country.y2016;
                    cColor = "blue";

                    if(startArea>100000)
                    {
                        cColor = "red";
                    }




                d3.json("data/countries.geo.json", function(collection) {

                    color.domain([0, d3.max(features, nameLength)]);

                    collection.features.forEach(function (setC) {




                        if(setC.properties.name == cName)
                        {
                            console.log(cName);
                            svg.select("path")
                                .style("fill", cColor)

                        }

                    });





                    var allC = collection.features;
                    allC.forEach(function (d) {
                        var tempName = d.properties.name


                    });



                    states.selectAll("path")
                        .attr("id", "states")
                        .data(collection.features)
                        .enter().append("svg:path")
                        .attr("d", path)
                        .on("click", clicked)




                });




        });



    });


    function clicked(d) {
        // ... add click functionality!


        var selection = d3.select(this).style("fill", "black");
        selection.classed("selected", !selection.classed("selected"));

        if (selection.classed("selected")==false) {
            selection.style("fill", "LightGray");
            console.log("WHITE");
        }
        console.log("clicking?");

        var centerPoint = getCenter(d);
        console.log(centerPoint);


        d3.csv("/data/ForestData.csv", function (countries){
            countries.forEach(function (country) {
                var cName = country.Country,
                    startArea= country.y1990,
                    endArea = country.y2016;

                if (d.properties.name==cName)
                {

                }


            });


        });

    }



    // --------------- Zoom & Pan functionality -----------------------------

    var zoom = d3.behavior.zoom()
        .translate([defaultTranslateX, defaultTranslateY])
        .scale(defaultZoom)
        .scaleExtent([defaultZoom, 100])
        .on("zoom", zoomed);

    d3.select("body")
        .call(zoom);

    function zoomed() {
        svg.transition()
            .duration(750)
            .attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")")
            ;
    }

    // --------------------- Click functionality -----------------------------







    // ----------------------------- Center of Country -----------------------------------------

    function getCenter(polygon) {
        if ('geometry' in polygon) polygon = polygon.geometry
        if (!Array.isArray(polygon)) polygon = polygon.coordinates[0]

        var minx = miny = 1000
            ,   maxx = maxy = -1000
        for (var i = 0; i < polygon.length; i++) {
            var point = polygon[i]
            var x = point[0]
            var y = point[1]

            if (x < minx) minx = x
            else if (x > maxx) maxx = x
            if (y < miny) miny = y
            else if (y > maxy) maxy = y
        }

        return {
            type: 'Point',
            coordinates: [
                minx + ((maxx - minx) / 2),
                miny + ((maxy - miny) / 2)
            ]
        }
    }

    // ----------------------------- Center of Country -----------------------------------------




</script>
</body>